<!doctype html>
{% if book %}
<title>{{ book.title if book.title else 'New Book' + ' - MangaDB' }}</title>
{% else %}
<title>MangaDB</title>
{% endif %}
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='fontawesome-all.css') }}">
{# <link rel=stylesheet type=text/css href="{{ url_for('static', filename='bootstrap.min.css') }}"> #}
{# instead of manually coping over stuff from tsuminos html and css im just using their stylesheet now #}
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='tsucss.css') }}">
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
{# src https://appelsiini.net/projects/lazyload or https://github.com/tuupola/jquery_lazyload/tree/2.x #}
<script type="text/javascript" src="{{ url_for('static', filename='jquery-3.3.1.min.js') }}"></script>
<meta name="csrf-token" content="{{ csrf_token() }}">
<script type="text/javascript">
    // configure jquery ajax requests to send csrf_token as X-CSRF-Token header on POST request
    // taken from flask-wtf

    // The settings specified here will affect all calls to $.ajax or Ajax-based derivatives
    // such as $.get(). This can cause undesirable behavior since other callers (for example,
    // plugins) may be expecting the normal default settings. For that reason we strongly
    // recommend against using this API. Instead, set the options explicitly in the call
    // or define a simple plugin to do so.
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", $('meta[name="csrf-token"]').attr('content'));
            }
        },
        // after we get response and success etc was called
        complete: function(jqXHR, textStatus) {
            // get and set new token
            let new_token = jqXHR.getResponseHeader("X-CSRFToken");
            if (new_token) {
                $('meta[name="csrf-token"]').attr('content', new_token);
                // also set hidden csrf-token fields otherwise their token will be invalid
                $('input[name="_csrf_token"]').attr("value", new_token);
            }
        }
    });
</script>
<script src="{{ url_for('static', filename='lazyload.js') }}"></script>
{# <script src="{{ url_for('static', filename='bootstrap.min.js') }}"></script> #}
<div class=page>
	<h1><a href="/" id="title-anchor">MangaDB</a>
    {% if "authenticated" in session %}
    <span class="nav-login-out"><a href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt"></i></a></span>
    {% else %}
    <span class="nav-login-out"><a href="{{ url_for('auth.login') }}"><i class="fas fa-sign-in-alt"></i></a></span>
    {% endif %}
    <a id="add-book-btn" class="book-read-button button-stack red-color" href="{{ url_for('main.show_add_book') }}">
        <i class="fas fa-plus"></i>
    </a>
    </h1>
	{% with messages = get_flashed_messages(with_categories=true) %}
		{% if messages %}
		    <div class="flash dark-color">
			<ul class="flash-messages">
			{% for category, message in messages %}
			<li class="{{ category }}">{{ message }}</li>
			{% endfor %}
			</ul>
		    </div>
		{% endif %}
	{% endwith %}
{% block body %}{% endblock %}
</div>
<script>
    $("img").on("error", function() {
        $(this).attr("src", "{{ url_for('static', filename='no-image.png') }}");
    });
</script>

<div class="jump-book-container">
    <form action="{{ url_for('main.jump_to_book_by_url') }}" method=post class="search-tags">
    {{ csrf_token_field() }}
	<div class="container-align-left" id="jump-url-field-container">
	<input value="" type=text name="ext_url" class="data-search" id="jumpURL">
	</div>
	<div class="container-align-right" id="jump-url-btn-container">
	<button type="submit" id="jump-book-btn" class="book-read-button button-stack red-color">
		<i class="fas fa-share button-icon"> </i> <span id="hide-on-screen-width">Jump</span>
	</button>
	</div>
    </form>
</div>
