{% extends "book.html" %}
{% block book_info %}
<div class="book-line">
<div class="book-info">Title</div>
<div class="book-data" id="Title">
	{{ book.title }}
</div>
</div>
<div class="book-line">
<div class="book-info">Pages</div>
<div class="book-data" id="Pages">
	{{ book.pages }}
</div>
</div>
<div class="book-line">
<div class="book-info">Status</div>
<div class="book-data" id="Status">
	{{ book.status }}
</div>
</div>
<div class="book-line">
<div class="book-info">My Rating</div>
<div class="book-data" id="MyRating">
	{% for n in range(5) %}
	{# check for my_rating being None and set all stars active as long as rating>n #}
	{# my_rating is float so convert to float #}
	{% if book.my_rating and (book.my_rating > n) %}
	<a href={{ url_for('rate_book_internal', book_id=book.id, rating=n+1.0) }} title={{ n + 1 }}><i class="fa fa-star star-active"></i></a>
	{% else %}
	<a href={{ url_for('rate_book_internal', book_id=book.id, rating=n+1.0) }} title={{ n + 1 }}><i class="fa fa-star star-inactive"></i></a>
	{% endif %}
	{% endfor %}
</div>
</div>
<div class="book-line">
<div class="book-info">Language</div>
<div class="book-data" id="Language">
	<a class="book-tag" href="{{ url_for('search_books', searchstring='language:\"' + book.language + '\"') }}">
	{{ book.language }}
	</a>
</div>
</div>
<div class="book-line">
<div class="book-info">Category</div>
<div class="book-data" id="Category">
{% for cat in book.category %}
<a class="book-tag" href="#">
	{{ cat }}
</a>
{% endfor %}
</div>
</div>
{% if book.collection %}
<div class="book-line">
<div class="book-info">Collection</div>
<div class="book-data" id="Collection">
{% for collection in book.collection %}
	<a class="book-tag" href="{{ url_for('search_books', searchstring='collection:\"' + collection + '\"') }}">
	{{ collection }}
	</a>
{% endfor %}
</div>
</div>
{% endif %}
{% if book.groups %}
	<div class="book-line">
	<div class="book-info">Group</div>
	<div class="book-data" id="Group">
		{% for group in book.groups %}
			<a class="book-tag" href="{{ url_for('search_books', searchstring='groups:\"' + group + '\"') }}">
				{{ group }}
			</a>
		{% endfor %}
	</div>
	</div>
{% endif %}
{% if book.artist %}
<div class="book-line">
<div class="book-info">Artist</div>
<div class="book-data" id="Artist">
	{% for artist in book.artist %}
		<a class="book-tag" href="{{ url_for('search_books', searchstring='artist:\"' + artist + '\"') }}">
			{{ artist }}
		</a>
	{% endfor %}
</div>
</div>
{% endif %}
{% if book.parody %}
	<div class="book-line">
	<div class="book-info">Parody</div>
	<div class="book-data" id="Parody">
	{% for parody in book.parody %}
		<a class="book-tag" href="#">
			{{ parody }}
		</a>
	{% endfor %}
	</div>
	</div>
{% endif %}
{% if book.character %}
	<div class="book-line">
	<div class="book-info">Character</div>
	<div class="book-data" id="Character">
		{% for char in book.character %}
			<a class="book-tag" href="{{ url_for('search_books', searchstring='character:\"' + char + '\"') }}">
				{{ char }}
			</a>
		{% endfor %}
	</div>
	</div>
{% endif %}
<div class="book-line">
<div class="book-info">Tag</div>
<div class="book-data" id="Tag">
	{% for tag in book.tag %}
		{# use get with /search?tagstring= (done by url_for) to search for tag on click #}
		<a class="book-tag" href="{{ url_for('search_books', searchstring='tags:\"' + tag + '\"') }}">
			{{ tag }}
		</a>
	{% endfor %}
</div>
</div>
<div class="book-line">
<div class="book-info">List</div>
<div class="book-data" id="List">
	{% for li in book.list %}
		<a class="book-tag list-tag" href="{{ url_for('search_books', searchstring='list:\"' + li + '\"') }}">
			{{ li }}
		</a>
	{% endfor %}
</div>
</div>
{% if book.note %}
<div class="book-line">
<div class="book-info">Note</div>
<div class="book-data" id="Note">
	{% for line in book.note.splitlines() %}
		{{ line }}<br />
	{% endfor %}
</div>
</div>
{% endif %}
<div class="book-line">
<div class="book-info"></div>
<div class="book-data" id="">
{% if favorite %}
<a href={{ url_for('remove_book_favorite', book_id=book.id) }} id="btnFavoriteHandler" class="book-read-button button-stack button-leftmost" data-get="/Book/GetFavorite/36122" data-add="/Book/AddFavorite/36122" data-remove="/Book/RemoveFavorite/36122"><i class="fa fa-heart"></i> Favorited</a>
{% else %}
<a href={{ url_for('add_book_favorite', book_id=book.id) }} id="btnFavoriteHandler" class="book-read-button button-stack button-leftmost dark-color"><i class="fa fa-plus"></i> Add to Favorite</a>
{% endif %}

<a href="{{ url_for('write_info_txt_by_id', book_id=book.id) }}" class="book-read-button button-stack red-color">
<i class="fas fa-file-alt"></i>
Write info.txt
</a>

<a href={{ url_for('show_edit_book', book_id=book.id) }} class="book-read-button button-stack red-color"><i class="fas fa-edit"></i> Edit</a>
<a href="/" id="backToIndex" class="book-read-button button-stack">
<i class="fa fa-home"> </i>
BACK TO INDEX
</a>
</div>
</div>
{% endblock %}
{% block ext_infos %}
<div style="margin: 1em 0;"></div>
{% for ext_info in book.ext_infos %}
{# loop.index is 1-based -> use loop.index0 for 0-based #}
{% if (loop.index0 % 2) == 0 %}
<div class="row row-no-margin">
{% endif %}
<div id="ext-info">
<div class="row row-no-margin">
	<div>
	<div class="ext-info-title" style="display:inline-block;">External Link on {{ ext_info.site|capitalize() }}</div>
	<div style="float:right;position:relative;top:5px;">Last Update: {{ ext_info.last_update }}</div>
<hr>
	</div>
</div>
<div class="col-md-6 ext-info-container" style="border-spacing: 3px;">
	<div class="ext-info-line">
	<div class="ext-info">Uploader</div>
	<div class="ext-info-data" id="Uploader">
		<a class="book-tag" href="#">
			{{ ext_info.uploader }}
		</a>
	</div>
	</div>
	<div class="ext-info-line">
	<div class="ext-info">Uploaded</div>
	<div class="ext-info-data" id="Uploaded">
		{{ ext_info.upload_date }}
	</div>
	</div>
	{% if ext_info.rating is not none %}
	<div class="ext-info-line">
	<div class="ext-info">Rating</div>
	<div class="ext-info-data" id="Rating">
		{{ ext_info.rating }} ({{ ext_info.ratings if ext_info.ratings else 'N/A'}} users / {{ ext_info.favorites if ext_info.favorites else 'N/A' }} favs)
	</div>
	</div>
	{% endif %}
	<div class="ext-info-line">
	<div class="ext-info">Censorship</div>
	<div class="ext-info-data" id="Censorship">
		{{ ext_info.censorship }}
	</div>
	</div>
</div> {# ext-info-container #}
	<div class="ext-info-data" id="">
		<a href={{ 'http://www.tsumino.com/Read/View/' ~ ext_info.id_onpage }} id="btnReadOnline" class="book-read-button button-stack">
		<i class="fa fa-arrow-circle-right"> </i>
		Read Online
		</a>

		{% if ext_info.downloaded %}
		<a href="" id="btnDownloadEntry" class="book-read-button button-stack green-color">
		<i class="fas fa-check-circle"> </i>
		Downloaded
		</a>
		{% else %}
		{# able to open this link in a tab and book will be marked as downloaded while the new tab will be redirected to the dl page, setting downloaded to 0 should be done using the list edits, since pressing the dl button can happen on accident to easily #}
		{# reload page when link is clicked (onclick=window.location.reload() ) so downloaded value gets updated -> but doesnt work when opened in new window, onclick=window.open(url, '_blank') [watch out that quotation marks get alternated etc.!] works but its a PopUp and has to be allowed first, but this is the only solution (with opening tsumino dl and displaying downloaded correctly) since just clicking and then going back after dl will also show old values (href to tsumino with _blank and reload -> flask wont get called at all) #}
		{# works with href zu tsumino dl and target _blank mit onclick by assigning window.location.href (url of the current page) which doesnt require PopUp-privileges -> assigning url to window.location.href=url =^ redirect to url => redirect current window to set_dl (downloaded get set and page will display correct vals) and by href _blank a new tab will be opened to tsumino dl page BUT this wont work with open new tab/middle mouse click then it will just open the tsumino dl page #}
		{# Ueber das Objekt location, das in der JavaScript-Objekthierarchie unterhalb des window-Objekts liegt, haben Sie Zugriff auf den vollstaendigen URI der aktuell angezeigten Web-Seite. Sie koennen den URI oder Teile davon zur Weiterverarbeitung abfragen und aendern. Beim Aendern fuehrt der Web-Browser einen Sprung zu einem neuen URI aus, genau so wie bei einem Verweis #}
		{# onclick="window.location.href={{..}}" wont work since url needs to be encased by quotation marks -> onclick="window.location.href='{{..}}'" (then also alternate quotation marks #}
		<a href="{{ "http://www.tsumino.com/Download/Index/" ~ ext_info.id_onpage }}" target="_blank" id="btnDownloadEntry" class="book-read-button button-stack red-color" onclick="window.location.href='{{ url_for("set_dl", ext_info_id=ext_info.id) }}'">
		<i class="fa fa-arrow-circle-right"> </i>
		Download on Tsumino
		</a>
		{% endif %}
		<a href="{{ url_for('update_book_by_id_onpage', book_id_onpage=ext_info.id_onpage) }}" class="book-read-button button-stack pink-color">
		<i class="fas fa-sync-alt"></i>
		Update Book
		</a>


</div>
</div>
{% if (loop.index0 % 2) == 0 %}
</div> {# row end #}
{% endif %}
{% endfor %}
{% endblock %}
{% block collections %}
{% if collections %}
<div style="margin: 1em 0;"></div>
{% for coll_name, info_rows in collections %}
	<div class="row">
	<div class="col-md-12">
	<div>
	<div style="display: inline-block;" class="book-title">Collection: {{ coll_name }}</div>
	<div style="display: inline-block;">
	View entries from the collection this entry belongs to (not ordered chronologically)
	</div>
	<hr>
	</div>
	<div class="col-md-12">
	<div class="book-collection-table">
	<div class="trow">
	{# <span class="theader">#</span> #}
	<span class="theader">Name</span>
	<span class="theader">Rating</span>
	<span class="theader">Pages</span>
	{# <span class="theader collection-position hidden">Position</span> #}
	</div>

	{% for row in info_rows %}
	<a href="{{ url_for('show_info', book_id=row.id) }}" class="trow {{ 'book-collection-is-me' if row.id == book.id else '' }}">
	{# <span class="tcell">1</span> #}
	<span class="tcell" width="100%">{{ row.title }}</span>
	{# cant use None in jinja have to use none (in-built function) #}
	<span class="tcell">{{ row.my_rating if row.my_rating is not none else 'Not rated' }} <span><i class="fa fa-star" aria-hidden="true"></i></span></span>
	<span class="tcell">{{ row.pages }}</span>
	{# <span class="tcell collection-position hidden">0</span> #}
	</a>
	{% endfor %}

	</div>
	</div> {# coll table div end #}
	</div>
	</div> {# row end #}
	<div class="row row-no-margin" style="margin-bottom: 1em;"></div>
{% endfor %}
{% endif %}
{% endblock %}
